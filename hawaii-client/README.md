# Hawaii-Generated NOCFO API Client

This directory contains the F# client generated by Hawaii from the NOCFO OpenAPI specification.

## Structure

```
hawaii-client/
â”œâ”€â”€ preprocess-openapi.fsx       # Script to normalize operationId fields
â”œâ”€â”€ openapi-normalized.json      # Preprocessed OpenAPI spec with clean names
â”œâ”€â”€ nocfo-api-hawaii.json        # Hawaii configuration
â”œâ”€â”€ generated/                   # Hawaii-generated code (regenerated on each run)
â”‚   â”œâ”€â”€ Client.fs               # API client with methods like BusinessesList, AccountsList
â”‚   â”œâ”€â”€ Types.fs                # DTOs and response types
â”‚   â”œâ”€â”€ OpenApiHttp.fs          # HTTP helpers
â”‚   â”œâ”€â”€ StringEnum.fs           # Minimal Fable compatibility shim
â”‚   â””â”€â”€ NocfoApi.fsproj         # F# project file
â””â”€â”€ TestClient.fsx              # Simple test script
```

## Getting a Token

The NOCFO API requires a Personal Access Token (PAT) for authentication.

1. **Visit the token management page:**
   - Testing: https://login-tst.nocfo.io/auth/tokens/
   - Production: https://login.nocfo.io/auth/tokens/

2. **Log in** with your NOCFO credentials

3. **Generate a new token** (give it a descriptive name like "API Testing")

4. **Copy the token** â€” you won't be able to see it again!

## Testing the Generated Client

### Step 1: Set your token as an environment variable

```bash
export NOCFO_TOKEN="your_token_here"
```

### Step 2: Run the test script

```bash
cd hawaii-client
dotnet fsi TestClient.fsx
```

The script will:
- âœ… List businesses (paginated, first 2 results)
- âœ… List accounts for the first business (first 3 results)
- Display detailed output including pagination metadata

### Example output:

```
ğŸ”§ Setting up NOCFO API client...
   Base URL: https://api-tst.nocfo.io
   Token: abc12345***

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  NOCFO API Client Test Suite
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ Testing BusinessesList endpoint...
âœ… Success! Retrieved businesses:
   Total count: 5
   Results in this page: 2
   Next page: https://api-tst.nocfo.io/v1/business/?page=2
   Previous page: none

   Business #1:
     ID: 123
     Name: Acme Corp
     Slug: acme-corp
     Created: 2024-01-15
...
```

## Regenerating the Client

If the NOCFO API spec changes:

```bash
# 1. Update api/openapi.json with the new spec

# 2. Preprocess to normalize operation names
dotnet fsi preprocess-openapi.fsx ../api/openapi.json openapi-normalized.json

# 3. Regenerate with Hawaii
hawaii --config nocfo-api-hawaii.json
```

## Next Steps

- [ ] Add basic HTTP error handling, e.g. 401 etc.
- [ ] Add AsyncSeq wrapper for lazy pagination
- [ ] Implement proper error handling (non-2xx responses)
- [ ] Add authentication token helper
- [ ] Create integration tests with realistic scenarios
